# MoRAG Environment Configuration
# Copy this file to .env and fill in your actual values

# =============================================================================
# API Keys
# =============================================================================

# Google AI (Gemini) API Key - Required for LLM operations
GEMINI_API_KEY=your_gemini_api_key_here
GEMINI_MODEL=gemini-pro
GEMINI_EMBEDDING_MODEL=text-embedding-004
GEMINI_VISION_MODEL=gemini-1.5-flash

# OpenAI API Key - Optional, for OpenAI models
OPENAI_API_KEY=your_openai_api_key_here

# Anthropic API Key - Optional, for Claude models
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# =============================================================================
# API Configuration
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4

# =============================================================================
# Database Configuration
# =============================================================================

# Qdrant Vector Database Configuration
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION_NAME=morag_documents
QDRANT_API_KEY=
QDRANT_URL=http://localhost:6333

# Redis Configuration (for Celery and caching)
REDIS_URL=redis://localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# Task Queue
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# =============================================================================
# Application Configuration
# =============================================================================

# Environment (development, staging, production)
ENVIRONMENT=development

# Debug mode
DEBUG=true

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json

# =============================================================================
# File Storage
# =============================================================================
UPLOAD_DIR=./uploads
TEMP_DIR=./temp
DATA_DIR=./data
LOGS_DIR=./logs
MAX_FILE_SIZE=100MB

# =============================================================================
# Security
# =============================================================================
API_KEY_HEADER=X-API-Key
ALLOWED_ORIGINS=["http://localhost:3000"]
SECRET_KEY=your_secret_key_here
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# =============================================================================
# Device Configuration
# =============================================================================
# Preferred device for AI processing (auto, cpu, cuda)
PREFERRED_DEVICE=auto
# Force CPU usage even if GPU is available
FORCE_CPU=false

# =============================================================================
# Processing Configuration
# =============================================================================
MAX_CHUNK_SIZE=1000
MAX_CONCURRENT_TASKS=10
WEBHOOK_TIMEOUT=30

# Document Processing Configuration
DEFAULT_CHUNKING_STRATEGY=page
ENABLE_PAGE_BASED_CHUNKING=true
MAX_PAGE_CHUNK_SIZE=8000

# Audio Processing Configuration
WHISPER_MODEL_SIZE=base
ENABLE_SPEAKER_DIARIZATION=true
ENABLE_TOPIC_SEGMENTATION=true
AUDIO_DEVICE=auto

# Video Processing Configuration
EXTRACT_AUDIO=true
EXTRACT_FRAMES=false
FRAME_INTERVAL=1.0
ENABLE_VIDEO_OCR=false

# Web Processing Configuration
USER_AGENT=MoRAG/1.0
REQUEST_TIMEOUT=30
MAX_CONTENT_LENGTH=10485760
ENABLE_JS_RENDERING=false

# Embedding Configuration
EMBEDDING_MODEL=text-embedding-004
EMBEDDING_DIMENSION=768
EMBEDDING_BATCH_SIZE=10
ENABLE_BATCH_EMBEDDING=true

# =============================================================================
# Retry Configuration
# =============================================================================
# Enable indefinite retries for rate limit errors (recommended for production)
MORAG_RETRY_INDEFINITELY=true
# Base delay between retries in seconds
MORAG_RETRY_BASE_DELAY=1.0
# Maximum delay between retries in seconds (5 minutes)
MORAG_RETRY_MAX_DELAY=300.0
# Exponential backoff multiplier
MORAG_RETRY_EXPONENTIAL_BASE=2.0
# Add random jitter to delays to avoid thundering herd
MORAG_RETRY_JITTER=true

# =============================================================================
# Celery Task Configuration
# =============================================================================
# Task timeout limits (in seconds)
# Soft limit: raises SoftTimeLimitExceeded exception for graceful cleanup
MORAG_CELERY_TASK_SOFT_TIME_LIMIT=7200  # 2 hours (default)
# Hard limit: kills the task process (should be higher than soft limit)
MORAG_CELERY_TASK_TIME_LIMIT=9000       # 2.5 hours (default)
# Worker configuration
MORAG_CELERY_WORKER_PREFETCH_MULTIPLIER=1    # Tasks per worker process
MORAG_CELERY_WORKER_MAX_TASKS_PER_CHILD=1000 # Max tasks before worker restart
